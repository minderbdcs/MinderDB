/*
Frank.
Please add new Table called ISSN_ATTRIBUTES with following columns:
RECORD_ID INTEGER NOT NULL, UNIQUE 
SSN_ID SSN_ID NOT NULL -* May need more than 1 Attribute record per ISSN in future *-
ATTR_CODE ATTRIBUTE
                       -* ‘MEDIA_XYZBF’ – Used to record Media Attributes where
                          X = Length of Media Roll e.g. 1,000 meters, Y = Media Width = 125mm and
                          Z = Media Thickness = 0.15mm and B = Backing Thickness = ‘0.055’ mm and
                          F= Finish = ‘GLOSS WHITE’ *-
ATTR_COLUMN1 VARCHAR(10) -* ‘1000’ *-
ATTR_COLUMN1_UOM UOM
ATTR_COLUMN2 VARCHAR(10) -* ‘125’ *-
ATTRA_COLUMN2_UOM UOM
ATTR_COLUMN3 VARCHAR(10) -* ‘0.15 *-
ATTR_COLUMN3_UOM UOM
ATTR_COLUMN4 VARCHAR(10) -* ‘0.055’ *-
ATTR_COLUMN4_UOM UOM
ATTR_COLUMN5 VARCHAR(10) -* ‘GLOSS WHITE’ *-
ATTR_COLUMN5_UOM UOM
ATTR_CREATE_DATE TIMESTAMP
ATTR_CREATE_BY PERSON
ATTR_LAST_UPDATE TIMESTAMP
ATTR_LAST_UPDATE_BY PERSON

*/

CREATE GENERATOR SSN_ATTRIBUTE_ID_GEN;

CREATE TABLE ISSN_ATTRIBUTES (
        RECORD_ID RECORD_ID NOT NULL,
        ATTR_SSN_ID SSN_ID NOT NULL,
        ATTR_CODE ATTRIBUTE_CODE NOT NULL, 
        ATTR_COLUMN1 ATTRIBUTE_NAME,
        ATTR_COLUMN1_UOM UOM,
        ATTR_COLUMN2 ATTRIBUTE_NAME,
        ATTR_COLUMN2_UOM UOM,
        ATTR_COLUMN3 ATTRIBUTE_NAME,
        ATTR_COLUMN3_UOM UOM,
        ATTR_COLUMN4 ATTRIBUTE_NAME,
        ATTR_COLUMN4_UOM UOM,
        ATTR_COLUMN5 ATTRIBUTE_NAME,
        ATTR_COLUMN5_UOM UOM,
        CREATE_DATE LAST_UPDATE_DATE,
        CREATE_BY USER_ID,
        LAST_UPDATE_DATE LAST_UPDATE_DATE,
        LAST_UPDATE_BY USER_ID,
CONSTRAINT ISSN_ATTRIBUTE_PKEY PRIMARY KEY (ATTR_SSN_ID, ATTR_CODE));


COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

CREATE OR ALTER TRIGGER ADD_ISSN_ATTRIBUTE FOR ISSN_ATTRIBUTES 
ACTIVE BEFORE INSERT POSITION 10 
AS
BEGIN
   IF ((NEW.RECORD_ID IS NULL) OR (NEW.RECORD_ID = 0)) THEN
   BEGIN
      NEW.RECORD_ID  = GEN_ID(SSN_ATTRIBUTE_ID_GEN,1);
   END
   NEW.LAST_UPDATE_DATE = 'NOW';
   NEW.CREATE_DATE = 'NOW';
END ^

CREATE OR ALTER TRIGGER MOD_ISSN_ATTRIBUTE FOR ISSN_ATTRIBUTES
ACTIVE BEFORE UPDATE POSITION 10 
AS
BEGIN
   IF ((NEW.RECORD_ID IS NULL) OR (NEW.RECORD_ID = 0)) THEN
   BEGIN
      NEW.RECORD_ID  = GEN_ID(SSN_ATTRIBUTE_ID_GEN,1);
   END
   NEW.LAST_UPDATE_DATE = 'NOW';
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;


alter table ISSN_ATTRIBUTES ADD CONSTRAINT ISSN_ATTRIBUTE_FK_SSN FOREIGN KEY (ATTR_SSN_ID ) REFERENCES ISSN(SSN_ID) ON UPDATE CASCADE;
