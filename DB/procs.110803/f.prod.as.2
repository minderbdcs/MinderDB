COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/*
	IN_COMPANY_ID is the company for orders to update
	IN_WH_ID is the wh_id for orders to update 
	IN_PROD_ID is the prod_id
	trans_date
	wk_user
*/
CREATE OR ALTER PROCEDURE ADD_PRODUCT_AS (IN_WH_ID VARCHAR(2) CHARACTER SET NONE,
IN_COMPANY_ID VARCHAR(20) CHARACTER SET NONE,
IN_PROD_ID VARCHAR(30) CHARACTER SET NONE,
IN_TRANS_DATE TIMESTAMP,
IN_USER VARCHAR(10) CHARACTER SET NONE,
RECORD_ID INTEGER)
AS 
DECLARE VARIABLE WK_WH_UNITS  INTEGER;
DECLARE VARIABLE WK_PO_WH_ID VARCHAR(30);
DECLARE VARIABLE WK_NEW_UNITS  INTEGER;
DECLARE VARIABLE WK_LOG_FILENAME VARCHAR(255);
DECLARE VARIABLE WK_LOG_RESULT INTEGER;
DECLARE VARIABLE WK_PROD_OWNER VARCHAR(10); 
DECLARE VARIABLE WK_PROD_DESC VARCHAR(50);
DECLARE VARIABLE WK_PROD_EXISTS INTEGER;
DECLARE VARIABLE WK_PROD_STATUS CHAR(2);
DECLARE VARIABLE WK_PO_FOUND INTEGER;
DECLARE VARIABLE WK_PO_QTY INTEGER;
DECLARE VARIABLE WK_PO_ORIG_QTY INTEGER;
DECLARE VARIABLE WK_PO_NEW_QTY INTEGER;
DECLARE VARIABLE WK_PO_STATUS CHAR(2);
DECLARE VARIABLE WK_USER VARCHAR(10);
DECLARE VARIABLE WK_PROD_TYPE CHAR(2);
DECLARE VARIABLE WK_DEVICE_ID CHAR(2);
DECLARE VARIABLE WK_TRN_TYPE CHAR(4);
DECLARE VARIABLE WK_TRN_CODE CHAR(1);
DECLARE VARIABLE WK_PUTLOCN_1 VARCHAR(10);
DECLARE VARIABLE WK_PUTLOCN_2 VARCHAR(10);
DECLARE VARIABLE WK_WEIGHT_X VARCHAR(10);
DECLARE VARIABLE WK_WEIGHT_UOM VARCHAR(10);
DECLARE VARIABLE WK_ALTPROD VARCHAR(30);
DECLARE VARIABLE WK_INSTR VARCHAR(50);
DECLARE VARIABLE WK_TEMPERATURE_ZONE VARCHAR(2);
DECLARE VARIABLE WK_GENERATE_SSN_METHOD VARCHAR(25);

BEGIN 
   /* first the pick lines for this product */
      UPDATE PICK_ITEM SET PICK_LINE_STATUS = 'OP'
      WHERE PICK_ITEM.PROD_ID = :IN_PROD_ID
      AND PICK_ITEM.PICK_LINE_STATUS = 'AS'
      AND EXISTS ( SELECT PICK_ORDER.PICK_ORDER FROM PICK_ORDER
         WHERE PICK_ORDER.PICK_ORDER = PICK_ITEM.PICK_ORDER
           AND PICK_ORDER.COMPANY_ID = :IN_COMPANY_ID
           AND PICK_ORDER.WH_ID = :IN_WH_ID 
           AND PICK_STATUS IN ('DA','OP','UC','CF') );
   /* then the pick lines for the ssns created  */
      UPDATE PICK_ITEM SET PICK_LINE_STATUS = 'OP'
      WHERE PICK_ITEM.SSN_ID IN (SELECT OBJECT FROM TRANSACTIONS_WORK WHERE RECORD_ID = :RECORD_ID)
      AND PICK_ITEM.PICK_LINE_STATUS = 'AS'
      AND EXISTS ( SELECT PICK_ORDER.PICK_ORDER FROM PICK_ORDER
         WHERE PICK_ORDER.PICK_ORDER = PICK_ITEM.PICK_ORDER
           AND PICK_ORDER.COMPANY_ID = :IN_COMPANY_ID
           AND PICK_ORDER.WH_ID = :IN_WH_ID 
           AND PICK_STATUS IN ('DA','OP','UC','CF') );

END ^

SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
