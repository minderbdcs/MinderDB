
CREATE TABLE PURCHASE_SUB_LINE (RECORD_ID  PURCHASE_DETAIL_ID NOT NULL,
        PURCHASE_ORDER PURCHASE_ORDER NOT NULL,
        PO_LINE PO_LINE NOT NULL,
        SSN_ID SSN_ID NOT NULL,
        PSL_OTHER1  OTHER_CHAR,
        PSL_OTHER2  OTHER_CHAR,
        PSL_OTHER_DATE3  OTHER_DATE,
        PSL_OTHER_DATE4  OTHER_DATE,
        PSL_STATUS STATUS,
        PSL_ORDER_QTY_RECEIVED QTY,
        USER_ID USER_ID,
        DEVICE_ID DEVICE_ID,
        CREATE_DATE CREATE_DATE,
        LAST_UPDATE_DATE LAST_UPDATE_DATE,
        LAST_UPDATE_BY   PERSON,
PRIMARY KEY (RECORD_ID));

CREATE INDEX PO_ITEM_SUB_DEVICE_IDX ON PURCHASE_SUB_LINE (DEVICE_ID);
CREATE INDEX PO_ITEM_SUB_PO_IDX ON PURCHASE_SUB_LINE (PURCHASE_ORDER, PO_LINE);
CREATE INDEX PO_ITEM_SUB_SSN_IDX ON PURCHASE_SUB_LINE (SSN_ID);
CREATE INDEX PO_ITEM_SUB_STATUS_IDX ON PURCHASE_SUB_LINE (PSL_STATUS);
CREATE INDEX PO_ITEM_SUB_UPDATE_IDX ON PURCHASE_SUB_LINE (LAST_UPDATE_DATE);

CREATE GENERATOR PURCHASE_SUB_LINE_GEN;

COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;
 

CREATE TRIGGER PURCHASE_SUB_LINE_ID FOR PURCHASE_SUB_LINE 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF (NEW.RECORD_ID IS NULL) THEN
      NEW.RECORD_ID = GEN_ID(PURCHASE_SUB_LINE_GEN, 1);
  IF (NEW.RECORD_ID = 0) THEN
      NEW.RECORD_ID = GEN_ID(PURCHASE_SUB_LINE_GEN, 1);
END ^

CREATE TRIGGER ADD_PO_SUB_LINE_TIME FOR PURCHASE_SUB_LINE 
ACTIVE BEFORE INSERT POSITION 20 
AS
BEGIN
   NEW.CREATE_DATE = 'NOW';
   NEW.LAST_UPDATE_DATE = 'NOW';
END ^

CREATE TRIGGER UPDATE_PO_SUB_LINE_TIME FOR PURCHASE_SUB_LINE 
ACTIVE BEFORE UPDATE POSITION 20 
AS
BEGIN
   NEW.LAST_UPDATE_DATE = 'NOW';
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
