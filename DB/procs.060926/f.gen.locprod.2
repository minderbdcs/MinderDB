COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/*
CREATE PROCEDURE LOCATION_CALC_PRODUCT (
WH_ID CHAR(2))
AS 
BEGIN EXIT; END ^
*/

ALTER PROCEDURE LOCATION_CALC_PRODUCT  (
WH_ID CHAR(2))
AS 
 

DECLARE VARIABLE WK_LOCN_ID VARCHAR(10);
DECLARE VARIABLE IMPORTSTATUS VARCHAR(40);
DECLARE VARIABLE WK_WH_ID CHAR(2);
DECLARE VARIABLE WK_PROD VARCHAR(30);
BEGIN
/*
have a procedure toset the prod_id
for a location

*/
   UPDATE LOCATION SET PROD_ID = NULL
   WHERE WH_ID = :WH_ID
   AND LOCN_ID STARTING 'PM';
   
   FOR SELECT LOCN_ID
   FROM LOCATION 
   WHERE WH_ID = :WH_ID
   AND LOCN_ID STARTING 'PM'
   AND REPLENISH='T' AND MIN_QTY IS NOT NULL
   INTO :WK_LOCN_ID
   DO
   BEGIN
      WK_PROD = '';
      SELECT FIRST 1 PROD_ID
      FROM ISSN
      WHERE WH_ID = :WH_ID
      AND LOCN_ID = :WK_LOCN_ID
      AND PROD_ID IS NOT NULL
      AND CURRENT_QTY > 0
      INTO :WK_PROD;
      IF (WK_PROD IS NULL) THEN
      BEGIN
         WK_PROD = '';
      END
      IF (WK_PROD > '') THEN
      BEGIN
         UPDATE LOCATION SET PROD_ID = :WK_PROD
         WHERE WH_ID = :WH_ID
         AND LOCN_ID = :WK_LOCN_ID;
         UPDATE PICK_ITEM
         SET WH_ID = :WH_ID,
         PICK_LOCATION = :WK_LOCN_ID,
         OVER_SIZED = 'F'
         WHERE PROD_ID = :WK_PROD
         AND PICK_ORDER STARTING '201';
      END
   END 
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
