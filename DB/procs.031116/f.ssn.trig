DROP   TRIGGER UPDATE_SSN_SSNSTATUS ^
COMMIT^

CREATE TRIGGER UPDATE_SSN_SSNSTATUS FOR SSN 
ACTIVE AFTER UPDATE POSITION 10 
AS                       

DECLARE VARIABLE WK_FOUND INTEGER;
DECLARE VARIABLE WK_ISSN VARCHAR(20);
DECLARE VARIABLE WK_ORIG_SSN VARCHAR(20);
DECLARE VARIABLE WK_STATUS CHAR(2);
DECLARE VARIABLE WK_OLD_STATUS CHAR(2);
DECLARE VARIABLE WK_ISSN_STATUS CHAR(2);
DECLARE VARIABLE WK_WH CHAR(2);
DECLARE VARIABLE WK_LOCN VARCHAR(10);
DECLARE VARIABLE WK_OLD_WH CHAR(2);
DECLARE VARIABLE WK_OLD_LOCN VARCHAR(10);
DECLARE VARIABLE WK_ISSN_WH CHAR(2);
DECLARE VARIABLE WK_ISSN_LOCN VARCHAR(10);

BEGIN    
    
    /* Get ISSN to update */
   WK_ISSN = NEW.SSN_ID;
   WK_STATUS = NEW.STATUS_SSN;
   WK_OLD_STATUS = OLD.STATUS_SSN;
   WK_LOCN = NEW.LOCN_ID;
   WK_OLD_LOCN = OLD.LOCN_ID;
   WK_WH = NEW.WH_ID;
   WK_OLD_WH = OLD.WH_ID;
   IF (WK_STATUS <> WK_OLD_STATUS) THEN
   BEGIN
      WK_FOUND = 0;
      SELECT 1, ISSN_STATUS
         FROM ISSN
         WHERE SSN_ID = :WK_ISSN
         INTO :WK_FOUND, :WK_ISSN_STATUS;
      IF (WK_FOUND = 1) THEN
      BEGIN
         IF (WK_ISSN_STATUS <> WK_STATUS) THEN
         BEGIN
            UPDATE ISSN 
               SET ISSN_STATUS = :WK_STATUS
               WHERE SSN_ID = :WK_ISSN;
         END
      END
   END
   IF ((WK_LOCN <> WK_OLD_LOCN) OR
       (WK_WH <> WK_OLD_WH)) THEN
   BEGIN
      WK_FOUND = 0;
      SELECT 1, WH_ID, LOCN_ID
         FROM ISSN
         WHERE SSN_ID = :WK_ISSN
         INTO :WK_FOUND, :WK_ISSN_WH, :WK_ISSN_LOCN;
      IF (WK_FOUND = 1) THEN
      BEGIN
         IF ((WK_ISSN_LOCN <> WK_LOCN) OR
             (WK_ISSN_WH <> WK_WH)) THEN
         BEGIN
            UPDATE ISSN 
               SET WH_ID = :WK_WH,
               LOCN_ID = :WK_LOCN
               WHERE SSN_ID = :WK_ISSN;
         END
      END
   END
END ^
 
