COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;


CREATE OR ALTER PROCEDURE ADD_LOCATION_LABEL (WK_LABEL_PRINTER DEVICE_ID ,
WK_LOCATION_ID LOCN_ID ,
WK_COPIES INTEGER)
RETURNS (WK_LABEL_DATA VARCHAR(32000) )
AS 
DECLARE VARIABLE WK_LABEL_TYPE CHAR(1);
DECLARE VARIABLE WK_LABEL_USE_EXTERNAL CHAR(1);
DECLARE VARIABLE WK_LABEL_FIELD_WRAPPER CHAR(1);
DECLARE VARIABLE WK_BUFFER VARCHAR(40);
DECLARE VARIABLE WK_LABEL_PART VARCHAR(32000);
DECLARE VARIABLE WK_LABEL_PREFIX VARCHAR(32000);
DECLARE VARIABLE WK_WHERE VARCHAR(100);

DECLARE VARIABLE WK_LOCN_WH_ID WH_ID;
DECLARE VARIABLE WK_LOCN_LOCN_ID LOCN_ID;
DECLARE VARIABLE WK_RESULT INTEGER; 
BEGIN 

   IF (WK_LOCATION_ID IS NULL) THEN
   BEGIN
      WK_LOCN_WH_ID = '';
      WK_LOCN_LOCN_ID = '';
   END
   ELSE
   BEGIN
/*    WK_LOCN_WH_ID = SUBSTR(WK_LOCATION_ID,1,2);
      WK_LOCN_LOCN_ID = SUBSTR(WK_LOCATION_ID,3,10); */
      WK_LOCN_WH_ID = SUBSTRING(WK_LOCATION_ID FROM 1 FOR 2);
      WK_LOCN_LOCN_ID = SUBSTRING(WK_LOCATION_ID FROM 3);
   END
   
   SELECT GENERATE_LABEL_TEXT, 
          EXTERNAL_SCRIPT_4_LABEL,
          LABEL_FIELD_WRAPPER 
   FROM CONTROL
   INTO :WK_LABEL_TYPE, 
        :WK_LABEL_USE_EXTERNAL,
        :WK_LABEL_FIELD_WRAPPER;
   IF (WK_LABEL_TYPE IS NULL) THEN
   BEGIN
      WK_LABEL_TYPE = 'F';
   END
   IF (WK_LABEL_TYPE = '') THEN
   BEGIN
      WK_LABEL_TYPE = 'F';
   END
   IF (WK_LABEL_USE_EXTERNAL IS NULL) THEN
   BEGIN
      WK_LABEL_USE_EXTERNAL = 'F';
   END
   IF (WK_LABEL_USE_EXTERNAL = '') THEN
   BEGIN
      WK_LABEL_USE_EXTERNAL = 'F';
   END
   IF (WK_LABEL_FIELD_WRAPPER IS NULL) THEN
   BEGIN
      WK_LABEL_FIELD_WRAPPER = '%';
   END
   IF (WK_LABEL_PRINTER IS NULL) THEN
   BEGIN
      WK_LABEL_PRINTER = 'PA';
   END
   WK_LABEL_PREFIX  = '';
   IF (WK_LABEL_PREFIX IS NULL) THEN
   BEGIN
      WK_LABEL_PREFIX  = '';
   END
   /* now must print a label */
   WK_RESULT = 0;
   IF (WK_LABEL_USE_EXTERNAL = 'F') THEN
   BEGIN
      IF (WK_LABEL_TYPE = 'F') THEN
      BEGIN
         /* use pc_label for label creation */
         WK_RESULT = 0;
         WK_LABEL_DATA = '';
         WK_LABEL_PART = '';
         WK_LABEL_DATA = WK_LABEL_DATA || :WK_LABEL_PREFIX;
         WK_WHERE = " WHERE WH_ID='" || WK_LOCN_WH_ID  || "' AND LOCN_ID='" || WK_LOCN_LOCN_ID || "'";
         EXECUTE PROCEDURE GET_TABLE_DATA ('LOCATION', WK_LABEL_FIELD_WRAPPER, '|', :WK_WHERE, 'LOCATION')
         RETURNING_VALUES :WK_LABEL_PART;
         IF (WK_LABEL_PART IS NULL) THEN
         BEGIN
            WK_LABEL_PART = '';
         END
         WK_LABEL_DATA = WK_LABEL_DATA || :WK_LABEL_PART;
      END
   END
   SUSPEND;
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;

