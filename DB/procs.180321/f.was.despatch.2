/*
cause event to be posted in live db when updating a despatch pick_order, pack_id or pick_despatch
add a generator to control this since dont have minder db at fms

*/
COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

CREATE GENERATOR SEND_UPDATE_EVENT^

CREATE OR ALTER TRIGGER UPDATE_PICK_ORDER_TIME FOR PICK_ORDER 
ACTIVE BEFORE UPDATE POSITION 20 
AS
  DECLARE VARIABLE WK_LOG_BUFFER VARCHAR(100) ;
  DECLARE VARIABLE WK_RM_SQL     VARCHAR(1024) ;
  DECLARE VARIABLE WK_EVENT_NAME VARCHAR(31) ;
  DECLARE VARIABLE WK_AUTORUN INTEGER;
BEGIN
   NEW.LAST_UPDATE_DATE = 'NOW';
   /* POST_EVENT 'PICK_ORDER_UP'; */
   WK_EVENT_NAME = 'PICK_ORDER_UP';
   WK_RM_SQL = 'execute procedure SEND_USER_EVENT (?)';
   WK_AUTORUN = GEN_ID(SEND_UPDATE_EVENT,0); 
   IF (WK_AUTORUN = 1) THEN
   BEGIN
      EXECUTE STATEMENT (WK_RM_SQL) (WK_EVENT_NAME)
      ON EXTERNAL 'localhost:minder' 
;
   END
   
END ^

CREATE OR ALTER TRIGGER UPDATE_PICK_DESPATCH_TIME FOR PICK_DESPATCH 
ACTIVE BEFORE UPDATE POSITION 20 
AS
  DECLARE VARIABLE WK_LOG_BUFFER VARCHAR(100) ;
  DECLARE VARIABLE WK_RM_SQL     VARCHAR(1024) ;
  DECLARE VARIABLE WK_EVENT_NAME VARCHAR(31) ;
  DECLARE VARIABLE WK_AUTORUN INTEGER;
BEGIN
   NEW.LAST_UPDATE_DATE = 'NOW';
   /* POST_EVENT 'PICK_DESPATCH_UP'; */
   WK_EVENT_NAME = 'PICK_DESPATCH_UP';
   WK_RM_SQL = 'execute procedure SEND_USER_EVENT (?)';
   WK_AUTORUN = GEN_ID(SEND_UPDATE_EVENT,0); 
   IF (WK_AUTORUN = 1) THEN
   BEGIN
   EXECUTE STATEMENT (WK_RM_SQL) (WK_EVENT_NAME)
      ON EXTERNAL 'localhost:minder' 
;
   END
END ^

CREATE OR ALTER TRIGGER UPDATE_PACK_ID_TIME FOR PACK_ID 
ACTIVE BEFORE UPDATE POSITION 20 
AS
  DECLARE VARIABLE WK_LOG_BUFFER VARCHAR(100) ;
  DECLARE VARIABLE WK_RM_SQL     VARCHAR(1024) ;
  DECLARE VARIABLE WK_EVENT_NAME VARCHAR(31) ;
  DECLARE VARIABLE WK_AUTORUN INTEGER;
BEGIN
   NEW.LAST_UPDATE_DATE = 'NOW';
   /* POST_EVENT 'PACK_ID_UP'; */
   WK_EVENT_NAME = 'PACK_ID_UP';
   WK_RM_SQL = 'execute procedure SEND_USER_EVENT (?)';
   WK_AUTORUN = GEN_ID(SEND_UPDATE_EVENT,0); 
   IF (WK_AUTORUN = 1) THEN
   BEGIN
   EXECUTE STATEMENT (WK_RM_SQL) (WK_EVENT_NAME)
      ON EXTERNAL 'localhost:minder' 
;
   END
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
