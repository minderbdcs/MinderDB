COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

ALTER PROCEDURE NEXT_GRN_ORDER_LABEL RETURNS (LABEL_NO VARCHAR(10) )
AS 
 

DECLARE VARIABLE WK_GRN_LABEL_NO CHAR(8);
DECLARE VARIABLE WK_GRN_LABEL_START INTEGER;
DECLARE VARIABLE WK_GRN_LABEL_STOP INTEGER;
DECLARE VARIABLE WK_LABEL_LENGTH INTEGER;
DECLARE VARIABLE WK_GRN_ADJUSTMENT INTEGER;
DECLARE VARIABLE WK_LEN_LABEL_NO INTEGER;
DECLARE VARIABLE WK_L_GRN_LABEL_NO  VARCHAR(8);
BEGIN
     SELECT MAX_LENGTH
     FROM PARAM
     WHERE DATA_ID = 'GRNORDER'
     INTO :WK_LABEL_LENGTH;
     WK_GRN_LABEL_NO = GEN_ID(GRN_LABEL_GEN, 1); 
     /* WK_GRN_LABEL_NO = GRN_LABEL_NO; */
     WK_GRN_LABEL_START = GEN_ID(GRN_LABEL_START, 0);
     WK_GRN_LABEL_STOP = GEN_ID(GRN_LABEL_STOP, 0);
     IF (WK_GRN_LABEL_NO > WK_GRN_LABEL_STOP) THEN
     BEGIN
        WK_GRN_ADJUSTMENT = WK_GRN_LABEL_START - WK_GRN_LABEL_STOP;
        WK_GRN_LABEL_NO = GEN_ID(GRN_LABEL_GEN, WK_GRN_ADJUSTMENT);
        WK_GRN_LABEL_NO = WK_GRN_LABEL_START;
     END
     WK_LEN_LABEL_NO = STRLEN(ALLTRIM(WK_GRN_LABEL_NO)) ;
     /* Get Label prefix */
     WK_L_GRN_LABEL_NO = '';
     /* Padding leading with 0 */
     WHILE (WK_LEN_LABEL_NO < WK_LABEL_LENGTH) DO
     BEGIN
        WK_L_GRN_LABEL_NO = WK_L_GRN_LABEL_NO || '0';
        WK_LEN_LABEL_NO = WK_LEN_LABEL_NO + 1;
     END
     WK_L_GRN_LABEL_NO = WK_L_GRN_LABEL_NO || ALLTRIM(WK_GRN_LABEL_NO);
     LABEL_NO = WK_L_GRN_LABEL_NO;
     /* GRN_LABEL_NO_OUT = WK_GRN_LABEL_NO; */
     SUSPEND;
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
