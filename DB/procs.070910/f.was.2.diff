0a1
> Database:  /data/asset.rf/wh.v39.gdb
4c5
< /* CREATE DATABASE '192.168.61.74:/data/asset.rf/wh.v39.gdb' DEFAULT CHARACTER SET NONE */
---
> /* CREATE DATABASE '/data/asset.rf/wh.v39.gdb' DEFAULT CHARACTER SET NONE */
568,577d568
< DECLARE EXTERNAL FUNCTION RDB$GET_CONTEXT 
< VARCHAR(80) CHARACTER SET NONE(null), VARCHAR(80) CHARACTER SET NONE(null)
< RETURNS VARCHAR(255) CHARACTER SET NONE FREE_IT
< ENTRY_POINT 'get_context' MODULE_NAME 'system_module';
< 
< DECLARE EXTERNAL FUNCTION RDB$SET_CONTEXT 
< VARCHAR(80) CHARACTER SET NONE(null), VARCHAR(80) CHARACTER SET NONE(null), VARCHAR(255) CHARACTER SET NONE(null)
< RETURNS INTEGER BY VALUE 
< ENTRY_POINT 'set_context' MODULE_NAME 'system_module';
< 
2017d2007
<         TEMPERATURE_ZONE CODE_TWO,
2194d2183
<         WEB_SITE DESCR,
2827d2815
<         TAX_APPLICABLE VALUE_TF,
3511,3512c3499
<         ORIGINAL_QUESTION_ID INTEGER,
<         QUESTION_TYPE CODE_TWO);
---
>         ORIGINAL_QUESTION_ID INTEGER);
3904a3892
> CREATE INDEX PICK_ITEM_DETAIL_DEVICE_IDX ON PICK_ITEM_DETAIL(DEVICE_ID);
5295,5308d5282
< CREATE PROCEDURE PC_UIXX (RECORD_ID INTEGER,
< WH_ID CHAR(2) CHARACTER SET NONE,
< LOCN_ID VARCHAR(10) CHARACTER SET NONE,
< OBJECT VARCHAR(30) CHARACTER SET NONE,
< TRN_TYPE VARCHAR(4) CHARACTER SET NONE,
< TRN_CODE CHAR(1) CHARACTER SET NONE,
< TRN_DATE TIMESTAMP,
< REFERENCE VARCHAR(40) CHARACTER SET NONE,
< QTY INTEGER,
< PERSON_ID VARCHAR(10) CHARACTER SET NONE,
< DEVICE_ID CHAR(2) CHARACTER SET NONE,
< INSTANCE_ID VARCHAR(10) CHARACTER SET NONE)
< AS 
< BEGIN EXIT; END ^
5637,5641d5610
< CREATE PROCEDURE UPDATE_ISSN (OBJECT VARCHAR(30) CHARACTER SET NONE,
< TRN_TYPE VARCHAR(4) CHARACTER SET NONE,
< FIELD_VALUE VARCHAR(40) CHARACTER SET NONE)
< AS 
< BEGIN EXIT; END ^
5826c5795,5797
< DECLARE VARIABLE REC_ID VARCHAR(10);
---
>  
> 
>   DECLARE VARIABLE REC_ID VARCHAR(10);
6050d6020
<  
6058a6029,6030
>   DECLARE VARIABLE WK_SERIAL VARCHAR(30);
>   DECLARE VARIABLE WK_STATUS_CODE VARCHAR(10);
6067c6039
<           SSN_ID, WH_ID, LOCN_ID, PROD_ID, STATUS_SSN, CURRENT_QTY, COMPANY_ID
---
>           SSN_ID, WH_ID, LOCN_ID, PROD_ID, STATUS_SSN, CURRENT_QTY, COMPANY_ID, SERIAL_NUMBER, STATUS_CODE
6069c6041
<           INTO :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY
---
>           INTO :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY, :WK_SERIAL, :WK_STATUS_CODE
6077,6078c6049,6050
<                   (SSN_ID, ORIGINAL_SSN, WH_ID, LOCN_ID, PROD_ID, ISSN_STATUS,CURRENT_QTY, COMPANY_ID)
<                   VALUES (:WK_SSN, :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY );
---
>                   (SSN_ID, ORIGINAL_SSN, WH_ID, LOCN_ID, PROD_ID, ISSN_STATUS,CURRENT_QTY, COMPANY_ID, SERIAL_NUMBER, STATUS_CODE)
>                   VALUES (:WK_SSN, :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY, :WK_SERIAL, :WK_STATUS_CODE );
6085c6057
<           SSN_ID, WH_ID, LOCN_ID, PROD_ID, STATUS_SSN, CURRENT_QTY, COMPANY_ID
---
>           SSN_ID, WH_ID, LOCN_ID, PROD_ID, STATUS_SSN, CURRENT_QTY, COMPANY_ID, SERIAL_NUMBER, STATUS_CODE
6088c6060
<           INTO :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY;
---
>           INTO :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY, :WK_SERIAL, :WK_STATUS_CODE;
6096,6097c6068,6069
<                   (SSN_ID, ORIGINAL_SSN, WH_ID, LOCN_ID, PROD_ID, ISSN_STATUS,CURRENT_QTY, COMPANY_ID)
<                   VALUES (:WK_SSN, :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY );
---
>                   (SSN_ID, ORIGINAL_SSN, WH_ID, LOCN_ID, PROD_ID, ISSN_STATUS,CURRENT_QTY, COMPANY_ID, SERIAL_NUMBER, STATUS_CODE)
>                   VALUES (:WK_SSN, :WK_SSN, :WK_WH_ID, :WK_LOCN_ID, :WK_PROD, :WK_STATUS, :WK_SSN_QTY, :WK_COMPANY, :WK_SERIAL, :WK_STATUS_CODE );
6509a6482
> /*
6510a6484
> */
6518a6493
> /*
6520a6496
> */
6526a6503
> /*
6528a6506
> */
7294a7273
>  
9710a9690
> /*
9711a9692
> */
9716a9698
> /*
9718a9701
> */
13209a13193,13195
>  
>  
>  
13239a13226,13228
>  
>  
> 
17940c17929,17933
< DECLARE VARIABLE strWH_ID CHAR(2); 
---
>  
>  
>  
>                              
>   DECLARE VARIABLE strWH_ID CHAR(2); 
18262c18255,18258
< DECLARE VARIABLE strWH_ID CHAR(2); 
---
>  
>  
>                              
>   DECLARE VARIABLE strWH_ID CHAR(2); 
19303,19403d19298
< ALTER PROCEDURE PC_UIXX (RECORD_ID INTEGER,
< WH_ID CHAR(2) CHARACTER SET NONE,
< LOCN_ID VARCHAR(10) CHARACTER SET NONE,
< OBJECT VARCHAR(30) CHARACTER SET NONE,
< TRN_TYPE VARCHAR(4) CHARACTER SET NONE,
< TRN_CODE CHAR(1) CHARACTER SET NONE,
< TRN_DATE TIMESTAMP,
< REFERENCE VARCHAR(40) CHARACTER SET NONE,
< QTY INTEGER,
< PERSON_ID VARCHAR(10) CHARACTER SET NONE,
< DEVICE_ID CHAR(2) CHARACTER SET NONE,
< INSTANCE_ID VARCHAR(10) CHARACTER SET NONE)
< AS 
< DECLARE VARIABLE strWH_ID CHAR(2);
<   DECLARE VARIABLE strINSTANCE VARCHAR(10);
<   DECLARE VARIABLE LOCN_EXIST INTEGER;
<   DECLARE VARIABLE LOCN_NAME VARCHAR(50);
<   DECLARE VARIABLE ISSN_EXIST INTEGER;
<   DECLARE VARIABLE strAUDIT_DESC VARCHAR(50);
<   DECLARE VARIABLE RESULT INTEGER;
<   DECLARE VARIABLE strTYPE VARCHAR(40);
<   DECLARE VARIABLE WK_ISSN VARCHAR(20);
<   DECLARE VARIABLE WK_CODE VARCHAR(75);
< BEGIN
<     strWH_ID = '';
<     strINSTANCE = '';
<     LOCN_EXIST = 0;
<     /* LOCN_NAME = 'Created during audit ' || :TRN_DATE; */
<     LOCN_NAME = LOCN_ID;
<     ISSN_EXIST = 0;
<     strAUDIT_DESC = '';
<     /* Check trasaction code */
< 
<         /* Check if warehouse exists */
<     SELECT WH_ID, INSTANCE_ID
<     FROM WAREHOUSE
<     WHERE WH_ID = :WH_ID
<     INTO :strWH_ID, :strINSTANCE;
< 
<     /* Check warehouse*/
<     IF (strWH_ID = '') THEN
<     BEGIN
<        /* Update transactions table */
<        EXECUTE PROCEDURE UPDATE_TRAN (:RECORD_ID, 'F', 'Invalid Warehouse');
<        EXIT;
<     END
<     ELSE
<     BEGIN /* WH */
<         /* Check instance */
<         IF (strINSTANCE <> :INSTANCE_ID) THEN
<         BEGIN
<           /* Update transactions table */
<           EXECUTE PROCEDURE UPDATE_TRAN (:RECORD_ID, 'F', 'Invalid InstanceID');
<           EXIT;
<         END
<         ELSE
<         BEGIN /* Location */
<            /* Check Location */
<            SELECT 1
<            FROM LOCATION
<            WHERE WH_ID = :WH_ID
<            AND LOCN_ID = :LOCN_ID
<            INTO :LOCN_EXIST;
< 
<            /* Location not exists, then add new location */
<            IF (LOCN_EXIST = 0) THEN
<            BEGIN
<               /* Add new Location record */
<               INSERT INTO LOCATION (LOCN_ID, WH_ID, LOCN_NAME, LAST_AUDITED_DATE)
<               VALUES (:LOCN_ID, :WH_ID, :LOCN_NAME, :TRN_DATE);
<            END
<      END /* INSTANCEID */
<      END /* WH */
< 
< 
<        SELECT 1
<        FROM ISSN
<        WHERE SSN_ID = :OBJECT
<        INTO :ISSN_EXIST;
< 
<        IF (ISSN_EXIST = 0) THEN
<        BEGIN
<                  /* Add new SSN */
<           EXECUTE PROCEDURE UPDATE_TRAN (:RECORD_ID, 'F', 'Invalid ISSN');
<           EXIT;
<        END
< 
< 
<     IF (:TRN_TYPE = 'UI01') THEN
<     BEGIN
<          EXECUTE PROCEDURE UPDATE_ISSN(:OBJECT, 'UI01', :REFERENCE);
<          strAudit_Desc = 'Other1 field updated ' || :REFERENCE;
<          EXECUTE PROCEDURE ADD_SSN_HIST(:WH_ID, :LOCN_ID, :OBJECT, :TRN_TYPE, :TRN_CODE, :TRN_DATE,
<                                               :strAUDIT_DESC, :REFERENCE, :QTY, :PERSON_ID, :DEVICE_ID);
< 
<     END
< 
<     EXECUTE PROCEDURE UPDATE_TRAN (:RECORD_ID, 'T', 'Processed successfully');
< 
< END ^
< 
26289d26183
< /*
26298d26191
< */
26954,26968d26846
< ALTER PROCEDURE UPDATE_ISSN (OBJECT VARCHAR(30) CHARACTER SET NONE,
< TRN_TYPE VARCHAR(4) CHARACTER SET NONE,
< FIELD_VALUE VARCHAR(40) CHARACTER SET NONE)
< AS 
< DECLARE VARIABLE strOTHER1 VARCHAR(50);
< BEGIN
<  IF (:TRN_TYPE = 'UI01') THEN      /* Update Type */
<     BEGIN
<       UPDATE ISSN
<       SET OTHER1 = :FIELD_VALUE
<       WHERE SSN_ID = :OBJECT;
<     END
< 
< END ^
< 
29506c29384
< ACTIVE BEFORE UPDATE POSITION 20 
---
> INACTIVE BEFORE UPDATE POSITION 20 
31422c31300
< INACTIVE BEFORE DELETE POSITION 0 
---
> ACTIVE BEFORE DELETE POSITION 0 
33303c33181
< ACTIVE BEFORE UPDATE POSITION 20 
---
> INACTIVE BEFORE UPDATE POSITION 20 
33439c33317
< ACTIVE BEFORE INSERT POSITION 20 
---
> INACTIVE BEFORE INSERT POSITION 20 
33849,33876d33726
< CREATE TRIGGER RUN_TRANSACTION_UI01 FOR TRANSACTIONS 
< ACTIVE AFTER INSERT POSITION 2 
< AS
< DECLARE VARIABLE WK_AUTORUN INTEGER;
< BEGIN
<  WK_AUTORUN = GEN_ID(AUTOEXEC_TRANSACTIONS,0);
<  IF (WK_AUTORUN = 1) THEN
<  BEGIN
<   IF (NEW.TRN_TYPE = 'UI01') THEN
<   BEGIN
<    EXECUTE PROCEDURE PC_UIXX
<     NEW.RECORD_ID ,
<     NEW.WH_ID,
<     NEW.LOCN_ID,
<     NEW.OBJECT,
<     NEW.TRN_TYPE,
<     NEW.TRN_CODE,
<     NEW.TRN_DATE,
<     NEW.REFERENCE,
<     NEW.QTY,
<     NEW.PERSON_ID,
<     NEW.DEVICE_ID,
<     NEW.INSTANCE_ID;
<    EXECUTE PROCEDURE TRAN_ARCHIVE;
<   END
<  END
< END ^
<  
37100d36949
< DECLARE VARIABLE WK_DATE_TXT VARCHAR(25);
37119,37123d36967
<      WK_DATE_TXT = CAST(CAST('NOW' AS TIMESTAMP) AS CHAR(24));
<      WK_LOG = 'TRN_TYPE ' || NEW.TRN_TYPE ||
<      ' TRN_CODE ' || NEW.TRN_CODE || ' date ' || WK_DATE_TXT ||
<      ' OBJECT ' || NEW.OBJECT || ' date ' || WK_DATE_TXT || ' start ';
<      INSERT INTO LOG(DESCRIPTION) VALUES(:WK_LOG);
37824,37828d37667
<      WK_DATE_TXT = CAST(CAST('NOW' AS TIMESTAMP) AS CHAR(24));
<      WK_LOG = 'TRN_TYPE ' || NEW.TRN_TYPE ||
<      ' TRN_CODE ' || NEW.TRN_CODE || ' date ' || WK_DATE_TXT ||
<      ' OBJECT ' || NEW.OBJECT || ' date ' || WK_DATE_TXT || ' end ';
<      INSERT INTO LOG(DESCRIPTION) VALUES(:WK_LOG);
39470,39471d39308
< DECLARE VARIABLE WK_LOG VARCHAR(255);
< DECLARE VARIABLE WK_DATE_TXT VARCHAR(25);
39491,39495d39327
<      WK_DATE_TXT = CAST(CAST('NOW' AS TIMESTAMP) AS CHAR(24));
<      WK_LOG = 'TRN_TYPE ' || NEW.TRN_TYPE ||
<      ' TRN_CODE ' || NEW.TRN_CODE || ' date ' || WK_DATE_TXT ||
<      ' OBJECT ' || NEW.OBJECT || ' date ' || WK_DATE_TXT || ' start ';
<      INSERT INTO LOG(DESCRIPTION) VALUES(:WK_LOG);
39795,39799d39626
<      WK_DATE_TXT = CAST(CAST('NOW' AS TIMESTAMP) AS CHAR(24));
<      WK_LOG = 'TRN_TYPE ' || NEW.TRN_TYPE ||
<      ' TRN_CODE ' || NEW.TRN_CODE || ' date ' || WK_DATE_TXT ||
<      ' OBJECT ' || NEW.OBJECT || ' date ' || WK_DATE_TXT || ' do pkua ';
<      INSERT INTO LOG(DESCRIPTION) VALUES(:WK_LOG);
39828,39832d39654
<      WK_DATE_TXT = CAST(CAST('NOW' AS TIMESTAMP) AS CHAR(24));
<      WK_LOG = 'TRN_TYPE ' || NEW.TRN_TYPE ||
<      ' TRN_CODE ' || NEW.TRN_CODE || ' date ' || WK_DATE_TXT ||
<      ' OBJECT ' || NEW.OBJECT || ' date ' || WK_DATE_TXT || ' end ';
<      INSERT INTO LOG(DESCRIPTION) VALUES(:WK_LOG);
44489c44311
<               AND PICK_LINE_STATUS = 'DC'
---
>               AND PICK_LINE_STATUS = 'DX'
48294c48116
<                PICK_LINE_STATUS = 'DC'
---
>                PICK_LINE_STATUS = 'DX'
