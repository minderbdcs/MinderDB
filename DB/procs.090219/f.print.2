
DROP   PROCEDURE PC_LABEL ;
DROP   PROCEDURE PRN_REQUEST_ARCHIVE ;
COMMIT;

ALTER TABLE PRINT_REQUESTS_ARCHIVE DROP PRN_DATA;
ALTER TABLE PRINT_REQUESTS_ARCHIVE ADD PRN_DATA TRN_DATA;

ALTER TABLE PRINT_REQUESTS DROP PRN_DATA;
ALTER TABLE PRINT_REQUESTS ADD PRN_DATA TRN_DATA;

COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

CREATE PROCEDURE PRN_REQUEST_ARCHIVE AS 
BEGIN
  
  /* Add record to PRN_REQUESTS_ARCHIVE table first */

  INSERT INTO PRINT_REQUESTS_ARCHIVE 
     (MESSAGE_ID, DEVICE_ID, PRN_TYPE, PRN_COPY, BASE_FILE_NAME, PRN_DATA, 
      PRN_DATE, PERSON_ID, REQUEST_STATUS,  ERROR_TEXT )
       
  SELECT MESSAGE_ID, DEVICE_ID, PRN_TYPE, PRN_COPY, BASE_FILE_NAME, PRN_DATA, 
      PRN_DATE, PERSON_ID, REQUEST_STATUS,  ERROR_TEXT 
  FROM PRINT_REQUESTS
  WHERE REQUEST_STATUS = 'XP'
     OR REQUEST_STATUS STARTING 'E';
  
  /* Delete records from WEB_REQUESTS table with COMPLETE is True */
  DELETE FROM PRINT_REQUESTS
  WHERE REQUEST_STATUS = 'XP'
     OR REQUEST_STATUS STARTING 'E';
  
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
