COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;


CREATE PROCEDURE PC_LABEL (
DEVICE_ID CHAR(2),
PRN_TYPE VARCHAR(40),
PRN_COPY INTEGER,
PRN_FILE_NAME VARCHAR(70),
PRN_DATA VARCHAR(1024),
PERSON_ID VARCHAR(10) )
RETURNS (RES INTEGER, ERROR_TEXT VARCHAR(1024))
AS 
DECLARE VARIABLE WK_DEVICE_ID CHAR(2);
DECLARE VARIABLE WK_LABEL_TYPE VARCHAR(70);
DECLARE VARIABLE WK_COPIES INTEGER;
DECLARE VARIABLE WK_DO_SYSLABEL CHAR(2);
BEGIN 
  
  /* insert into print_requests */
  /* with status NP  new request
			create the print file
                 CP  created print file
			send to the device
                 XP  completed */
  WK_DO_SYSLABEL = '';
  SELECT GENERATE_LABEL_TEXT 
  FROM CONTROL
  INTO :WK_DO_SYSLABEL;
  IF (WK_DO_SYSLABEL = 'F') THEN
  BEGIN
     INSERT INTO PRINT_REQUESTS (DEVICE_ID, PRN_TYPE, PRN_COPY, BASE_FILE_NAME, PRN_DATA, PERSON_ID, REQUEST_STATUS, ERROR_TEXT)
     VALUES ( :DEVICE_ID, :PRN_TYPE, :PRN_COPY, :PRN_FILE_NAME, :PRN_DATA, :PERSON_ID, 'NP', '');
     RES = 0;
     ERROR_TEXT = 'Print Request Sent';
  END
  ELSE
  BEGIN
     RES = -1;
     ERROR_TEXT = 'Not able to create Bartender files yet';
  END
  SUSPEND;

END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
