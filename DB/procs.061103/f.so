COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

CREATE GENERATOR SO_ADDRESS2^
CREATE GENERATOR SO_INSTR2_FAX^
SET GENERATOR SO_ADDRESS2 TO 0^
SET GENERATOR SO_INSTR2_FAX TO 0^

DROP TRIGGER PICK_ORDER_ADDRESS_UPD ^
COMMIT^
 
CREATE TRIGGER PICK_ORDER_ADDRESS_UPD FOR PICK_ORDER 
ACTIVE BEFORE UPDATE POSITION 10 
AS
/* Transfer of allocated replenish to another handheld */
DECLARE VARIABLE WK_AUTORUN INTEGER;
DECLARE VARIABLE WK_ADDRESS1 VARCHAR(100);
DECLARE VARIABLE WK_ADDRESS2 VARCHAR(100);
DECLARE VARIABLE WK_PERSON VARCHAR(10);
DECLARE VARIABLE WK_FAX_NO VARCHAR(30);
DECLARE VARIABLE WK_INSTR2 VARCHAR(255);
BEGIN
 WK_AUTORUN = GEN_ID(SO_ADDRESS2,0); 
 IF (WK_AUTORUN = 1) THEN
 BEGIN
  IF ((NEW.P_ADDRESS_LINE2 IS NULL) AND (NEW.P_ADDRESS_LINE1 IS NOT NULL)) THEN
  BEGIN
     WK_ADDRESS2 = '.';
     NEW.P_ADDRESS_LINE2 = WK_ADDRESS2;
  END
  IF (NEW.P_ADDRESS_LINE2 = '') THEN
  BEGIN
     WK_ADDRESS2 = '.';
     NEW.P_ADDRESS_LINE2 = WK_ADDRESS2;
  END
 END
 WK_AUTORUN = GEN_ID(SO_INSTR2_FAX,0); 
 IF (WK_AUTORUN = 1) THEN
 BEGIN
  IF ((NEW.PERSON_ID <> OLD.PERSON_ID) OR (OLD.PERSON_ID IS NULL)) THEN
  BEGIN
     WK_PERSON = NEW.PERSON_ID;
     SELECT FAX_NO 
     FROM PERSON 
     WHERE PERSON_ID = :WK_PERSON 
     INTO :WK_FAX_NO;
     IF (WK_FAX_NO IS NULL) THEN
     BEGIN
        WK_FAX_NO = 'None';
     END
     WK_INSTR2 = NEW.SPECIAL_INSTRUCTIONS1;
     IF (WK_INSTR2 IS NULL) THEN
     BEGIN
        WK_INSTR2 = '';
     END
     NEW.SPECIAL_INSTRUCTIONS1 = 'Fax ' || :WK_FAX_NO || :WK_INSTR2;
  END
 END
END ^
 
SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
