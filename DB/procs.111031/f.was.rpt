SELECT STOCK.* ,PP.SHORT_DESC, PP.MIN_QTY, PP.MAX_QTY, PP.PROD_TYPE, PP.REORDER_QTY ,
( SELECT SUM( PICK_ITEM.PICK_ORDER_QTY )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 0 )
          GROUP BY PICK_ITEM.PROD_ID 
) AS SALES_30_DAYS_QTY,
( SELECT SUM( PICK_ITEM.PICK_ORDER_QTY )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 1 )
          GROUP BY PICK_ITEM.PROD_ID 
) AS SALES_60_DAYS_QTY,
( SELECT SUM( PICK_ITEM.PICK_ORDER_QTY )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 2 )
          GROUP BY PICK_ITEM.PROD_ID 
) AS SALES_90_DAYS_QTY,
( SELECT SUM( PICK_ITEM.PICK_ORDER_QTY )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 3 )
          GROUP BY PICK_ITEM.PROD_ID 
) AS SALES_120_DAYS_QTY,

( SELECT COUNT(DISTINCT PICK_ORDER.PICK_ORDER )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 0 )
          GROUP BY PICK_ITEM.PROD_ID
) AS ORDERS_30_DAYS_QTY,

( SELECT COUNT(DISTINCT PICK_ORDER.PICK_ORDER )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 1 )
          GROUP BY PICK_ITEM.PROD_ID  
) AS ORDERS_60_DAYS_QTY,

( SELECT COUNT(DISTINCT PICK_ORDER.PICK_ORDER )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 2 )
          GROUP BY PICK_ITEM.PROD_ID  
) AS ORDERS_90_DAYS_QTY,

( SELECT COUNT(DISTINCT PICK_ORDER.PICK_ORDER )
          FROM PICK_ITEM JOIN PICK_ORDER
          ON PICK_ITEM.PICK_ORDER = PICK_ORDER.PICK_ORDER
          WHERE PICK_ITEM.PROD_ID = STOCK.PROD_ID
          AND (POS(',DA,DX,',PICK_ORDER.PICK_STATUS,0,1) > -1)
          AND (MODQUOT(DIFFDATE('NOW',PICK_ORDER.APPROVED_DESP_DATE,4),30) = 3 )
          GROUP BY PICK_ITEM.PROD_ID  
) AS ORDERS_120_DAYS_QTY


FROM PRODUCT_COMPANY_WH_STOCK_STATUS('%','','','Admin') AS STOCK 
JOIN PROD_PROFILE PP ON STOCK.PROD_ID = PP.PROD_ID  

WHERE  (PP.PROD_TYPE IN ('CS','PS','TI')) 
ORDER BY STOCK.PROD_ID  ;

