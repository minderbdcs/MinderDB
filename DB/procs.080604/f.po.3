COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;
 
ALTER TABLE CONTROL ADD DEFAULT_PURCHASE_TYPE CODE^ 

DROP TRIGGER ADD_PURCHASE_TYPE ^
COMMIT^

CREATE TRIGGER ADD_PURCHASE_TYPE FOR PURCHASE_ORDER 
ACTIVE BEFORE INSERT POSITION 2 
AS
DECLARE VARIABLE WK_ORDER_TYPE VARCHAR(40);
DECLARE VARIABLE WK_ORDER_COMPANY VARCHAR(40);
BEGIN
   WK_ORDER_TYPE = '';
   WK_ORDER_COMPANY = '';
   SELECT DEFAULT_PURCHASE_TYPE, COMPANY_ID
   FROM CONTROL
   INTO :WK_ORDER_TYPE, :WK_ORDER_COMPANY;

   IF (NEW.ORDER_TYPE IS NULL) THEN
   BEGIN
      NEW.ORDER_TYPE = :WK_ORDER_TYPE;
   END
   IF (NEW.COMPANY_ID IS NULL) THEN
   BEGIN
      NEW.ORDER_TYPE = :WK_ORDER_COMPANY;
   END
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
