
DROP   PROCEDURE PC_LABEL ;
DROP   PROCEDURE PRN_REQUEST_ARCHIVE ;
COMMIT;

CREATE DOMAIN CODE_32K VARCHAR(32000);

ALTER TABLE PRINT_REQUESTS_ARCHIVE DROP PRN_DATA;
ALTER TABLE PRINT_REQUESTS_ARCHIVE ADD PRN_DATA CODE_32K;

ALTER TABLE PRINT_REQUESTS ADD SAVE_DATA CODE_32K;
UPDATE PRINT_REQUESTS SET SAVE_DATA = PRN_DATA;
COMMIT;
ALTER TABLE PRINT_REQUESTS DROP PRN_DATA;
ALTER TABLE PRINT_REQUESTS ADD PRN_DATA CODE_32K;
UPDATE PRINT_REQUESTS SET PRN_DATA = SAVE_DATA;
COMMIT;
ALTER TABLE PRINT_REQUESTS DROP SAVE_DATA;


COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

CREATE PROCEDURE PRN_REQUEST_ARCHIVE AS 
BEGIN
  
  /* Add record to PRN_REQUESTS_ARCHIVE table first */

  INSERT INTO PRINT_REQUESTS_ARCHIVE 
     (MESSAGE_ID, DEVICE_ID, PRN_TYPE, PRN_COPY, BASE_FILE_NAME, PRN_DATA, 
      PRN_DATE, PERSON_ID, REQUEST_STATUS,  ERROR_TEXT )
       
  SELECT MESSAGE_ID, DEVICE_ID, PRN_TYPE, PRN_COPY, BASE_FILE_NAME, PRN_DATA, 
      PRN_DATE, PERSON_ID, REQUEST_STATUS,  ERROR_TEXT 
  FROM PRINT_REQUESTS
  WHERE REQUEST_STATUS = 'XP'
     OR REQUEST_STATUS STARTING 'E';
  
  /* Delete records from PRINT_REQUESTS table with COMPLETE is True */
  DELETE FROM PRINT_REQUESTS
  WHERE REQUEST_STATUS = 'XP'
     OR REQUEST_STATUS STARTING 'E';
  
END ^


SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
