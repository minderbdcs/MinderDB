
COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

ALTER PROCEDURE PC_LABEL_SALE_ORDER (REFERENCE VARCHAR(40) )
RETURNS (WK_RESULT INTEGER)
AS 

  DECLARE VARIABLE WK_FILE_PATH VARCHAR(70);
  DECLARE VARIABLE WK_FILE_PATH2 VARCHAR(70);
  DECLARE VARIABLE WK_PRINTER_DEVICE CHAR(2);
  DECLARE VARIABLE WK_ORDER VARCHAR(40);  
  DECLARE VARIABLE WK_LABEL_TEXT VARCHAR(256);
  
  DECLARE VARIABLE WK_LABEL_DATE TIMESTAMP;  
  DECLARE VARIABLE WK_DATE VARCHAR(20);  
  DECLARE VARIABLE WK_TIME VARCHAR(10);  
     
  DECLARE VARIABLE WK_HEADER VARCHAR(1);

  DECLARE VARIABLE WK_PO_COMPANY_ID VARCHAR(20);
  DECLARE VARIABLE WK_PO_CUSTOMER_PO_WO VARCHAR(20);
  DECLARE VARIABLE WK_PO_PICK_DUE_DATE VARCHAR(10);
  DECLARE VARIABLE WK_PO_PERSON_ID VARCHAR(10);
  DECLARE VARIABLE WK_PO_CONTACT_NAME VARCHAR(50); 
  DECLARE VARIABLE WK_PO_SPECIAL_INSTRUCTIONS1 VARCHAR(255);
  DECLARE VARIABLE WK_PO_SPECIAL_INSTRUCTIONS2 VARCHAR(255);
  DECLARE VARIABLE WK_PO_FREIGHT NUMERIC(9,2);
  DECLARE VARIABLE WK_PO_PAYMENT_METHOD VARCHAR(20);
  DECLARE VARIABLE WK_PO_TERMS VARCHAR(20);
  DECLARE VARIABLE WK_PO_AMOUNT_PAID NUMERIC(9,2);
  DECLARE VARIABLE WK_PO_SHIP_VIA VARCHAR(10);
  DECLARE VARIABLE WK_PO_OTHER1 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER2 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER3 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER4 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER5 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER6 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER7 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER8 VARCHAR(50);
  DECLARE VARIABLE WK_PO_OTHER9 VARCHAR(50);
  DECLARE VARIABLE WK_PO_P_FIRST_NAME VARCHAR(50);
  DECLARE VARIABLE WK_PO_P_ADDRESS_LINE1 VARCHAR(100);
  DECLARE VARIABLE WK_PO_P_ADDRESS_LINE2 VARCHAR(50);
  DECLARE VARIABLE WK_PO_P_ADDRESS_LINE3 VARCHAR(50);
  DECLARE VARIABLE WK_PO_P_ADDRESS_LINE4 VARCHAR(50);
  DECLARE VARIABLE WK_PO_P_ADDRESS_LINE5 VARCHAR(50);
  DECLARE VARIABLE WK_PO_P_POST_CODE VARCHAR(10);
  DECLARE VARIABLE WK_PO_P_COUNTRY VARCHAR(25);
  DECLARE VARIABLE WK_PO_OVER_SIZED VARCHAR(1);
  DECLARE VARIABLE WK_PO_NET_WEIGHT NUMERIC(9,3);
  DECLARE VARIABLE WK_PO_TAX_AMOUNT NUMERIC(9,2);
  DECLARE VARIABLE WK_PO_SUB_TOTAL_AMOUNT NUMERIC(9,2);
  DECLARE VARIABLE WK_PO_FREIGHT_TAX_AMOUNT NUMERIC(9,2);
  DECLARE VARIABLE WK_PO_PALLET_BASE VARCHAR(30);

BEGIN 
  
  /* GET THE PRINTER DIR */
  /* WK_PRINTER_DEVICE = SUBSTR(:REFERENCE,1,2); */
  EXECUTE PROCEDURE GET_REFERENCE_FIELD :REFERENCE, 1  RETURNING_VALUES :WK_PRINTER_DEVICE ; 
  EXECUTE PROCEDURE GET_REFERENCE_FIELD :REFERENCE, 2  RETURNING_VALUES :WK_HEADER ; 
  EXECUTE PROCEDURE GET_REFERENCE_FIELD :REFERENCE, 3  RETURNING_VALUES :WK_ORDER ; 
  /* WK_ORDER = SUBSTR(:REFERENCE,3,STRLEN(:REFERENCE)); */
  
  /* NEED THE DIRECTORY FOR THIS LABEL SET */
  SELECT WORKING_DIRECTORY FROM SYS_EQUIP 
  WHERE DEVICE_ID = :WK_PRINTER_DEVICE
  INTO :WK_FILE_PATH;
  
  WK_FILE_PATH2 = WK_FILE_PATH || 'ORDER.1XT';
  WK_LABEL_DATE = 'TOMORROW';
       
  IF (WK_HEADER = 'T') THEN
  BEGIN
     WK_LABEL_TEXT = '"PO_PICK_ORDER","' || 
              'Printer Device","' ||
              'PO_COMPANY_ID","' ||
              'PO_CUSTOMER_PO_WO","' ||
              'PO_PICK_DUE_DATE","' ||
              'PO_PERSON_ID","' ||
              'PO_CONTACT_NAME","' ; 
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
     WK_LABEL_TEXT = 'PO_SPECIAL_INSTRUCTIONS1';
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
     WK_LABEL_TEXT = '","';
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
     WK_LABEL_TEXT = 'PO_SPECIAL_INSTRUCTIONS2';
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
     WK_LABEL_TEXT = '","';
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
   
     WK_LABEL_TEXT = 'PO_FREIGHT","' ||
              'PO_PAYMENT_METHOD","' ||
              'PO_TERMS","' ||
              'PO_AMOUNT_PAID","' ||
              'PO_SHIP_VIA","' ||
              'PO_OTHER1","' ||
              'PO_OTHER2","' ||
              'PO_OTHER3","' ;
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
   
     WK_LABEL_TEXT = 'PO_OTHER4","' ||
              'PO_OTHER5","' ||
              'PO_OTHER6","' ||
              'PO_OTHER7","' ;
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
   
     WK_LABEL_TEXT = 'PO_OTHER8","' ||
              'PO_OTHER9","' ||
              'PO_P_FIRST_NAME","' ;
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
   
     WK_LABEL_TEXT =  'PO_P_ADDRESS_LINE1","' ||
              'PO_P_ADDRESS_LINE2","' ||
              'PO_P_ADDRESS_LINE3","' ;
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
   
     WK_LABEL_TEXT = 'PO_P_ADDRESS_LINE4","' ||
              'PO_P_ADDRESS_LINE5","' ||
              'PO_P_POST_CODE","' ||
              'PO_P_COUNTRY","' ||
              'PO_OVER_SIZED","' ||
              'PO_NET_WEIGHT","' ||
              'PO_TAX_AMOUNT","' ||
              'PO_SUB_TOTAL_AMOUNT","' ||
              'PO_FREIGHT_TAX_AMOUNT","' ||
              'PO_PALLET_BASE"';
   
     WK_RESULT = FILE_WRITELN(:WK_FILE_PATH2, :WK_LABEL_TEXT); 
     /* WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT); */
  END
/*
pi
PROD_ID,
PICK_ORDER_QTY,
SALE_PRICE,
TAX_RATE,
OTHER1,
OTHER2,
OTHER3,
OTHER4,
OTHER5,
OTHER6,
OTHER7,
OTHER8,
OTHER9,
BATCH_LINE
LINE_TOTAL ??
ZONE  =bay
WH_ID
PICK_LOCATION
calced locn short  = shelf + compartment 
OVER_SIZED
LINE COMMENTS

prod prof
SHORT_DESC

CONTINUATION
*/

  SELECT 
     COMPANY_ID,
     CUSTOMER_PO_WO,
     LPAD(MER_DAY(PICK_DUE_DATE),'0',2) || '/' || LPAD(MER_MONTH(PICK_DUE_DATE),'0',2) || '/' || SUBSTR(CAST(MER_YEAR(PICK_DUE_DATE) AS CHAR(4)) , 3,4),
     PERSON_ID,
     CONTACT_NAME, 
     SPECIAL_INSTRUCTIONS1,
     SPECIAL_INSTRUCTIONS2,
     FREIGHT,
     PAYMENT_METHOD,
     TERMS,
     AMOUNT_PAID,
     SHIP_VIA,
     OTHER1,
     OTHER2,
     OTHER3,
     OTHER4,
     OTHER5,
     OTHER6,
     OTHER7,
     OTHER8,
     OTHER9,
     P_FIRST_NAME,
     P_ADDRESS_LINE1,
     P_ADDRESS_LINE2,
     P_ADDRESS_LINE3,
     P_ADDRESS_LINE4,
     P_ADDRESS_LINE5,
     P_POST_CODE,
     P_COUNTRY,
     OVER_SIZED,
     NET_WEIGHT,
     TAX_AMOUNT,
     SUB_TOTAL_AMOUNT,
     FREIGHT_TAX_AMOUNT,
     PALLET_BASE
  FROM PICK_ORDER
  WHERE PICK_ORDER = :WK_ORDER
  INTO :WK_PO_COMPANY_ID,
     :WK_PO_CUSTOMER_PO_WO,
     :WK_PO_PICK_DUE_DATE,
     :WK_PO_PERSON_ID,
     :WK_PO_CONTACT_NAME, 
     :WK_PO_SPECIAL_INSTRUCTIONS1,
     :WK_PO_SPECIAL_INSTRUCTIONS2,
     :WK_PO_FREIGHT,
     :WK_PO_PAYMENT_METHOD,
     :WK_PO_TERMS,
     :WK_PO_AMOUNT_PAID,
     :WK_PO_SHIP_VIA,
     :WK_PO_OTHER1,
     :WK_PO_OTHER2,
     :WK_PO_OTHER3,
     :WK_PO_OTHER4,
     :WK_PO_OTHER5,
     :WK_PO_OTHER6,
     :WK_PO_OTHER7,
     :WK_PO_OTHER8,
     :WK_PO_OTHER9,
     :WK_PO_P_FIRST_NAME,
     :WK_PO_P_ADDRESS_LINE1,
     :WK_PO_P_ADDRESS_LINE2,
     :WK_PO_P_ADDRESS_LINE3,
     :WK_PO_P_ADDRESS_LINE4,
     :WK_PO_P_ADDRESS_LINE5,
     :WK_PO_P_POST_CODE,
     :WK_PO_P_COUNTRY,
     :WK_PO_OVER_SIZED,
     :WK_PO_NET_WEIGHT,
     :WK_PO_TAX_AMOUNT,
     :WK_PO_SUB_TOTAL_AMOUNT,
     :WK_PO_FREIGHT_TAX_AMOUNT,
     :WK_PO_PALLET_BASE;

  UPDATE PICK_ORDER SET LABEL_PRINTED_DATE = 'NOW'
  WHERE PICK_ORDER = :WK_ORDER;

  WK_DATE = MER_DAY(WK_LABEL_DATE) || '/' || MER_MONTH(WK_LABEL_DATE) || '/' || SUBSTR(CAST(MER_YEAR(WK_LABEL_DATE) AS CHAR(4)) , 3,4);
  WK_TIME = MER_HOUR(WK_LABEL_DATE) || ':' || MER_MINUTE(WK_LABEL_DATE) ;
  /* WK_DATE = WK_DATE || ' ' || WK_TIME; */
  IF (WK_PO_COMPANY_ID IS NULL) THEN
  BEGIN
     WK_PO_COMPANY_ID = '';
  END
  IF (WK_PO_CUSTOMER_PO_WO IS NULL) THEN
  BEGIN
     WK_PO_CUSTOMER_PO_WO = '';
  END
  IF (WK_PO_PICK_DUE_DATE IS NULL) THEN
  BEGIN
     WK_PO_PICK_DUE_DATE = '';
  END
  IF (WK_PO_PERSON_ID IS NULL) THEN
  BEGIN
     WK_PO_PERSON_ID = '';
  END
  IF (WK_PO_CONTACT_NAME IS NULL) THEN
  BEGIN
     WK_PO_CONTACT_NAME = '';
  END
  IF (WK_PO_SPECIAL_INSTRUCTIONS1 IS NULL) THEN
  BEGIN
     WK_PO_SPECIAL_INSTRUCTIONS1 = '';
  END
  IF (WK_PO_SPECIAL_INSTRUCTIONS2 IS NULL) THEN
  BEGIN
     WK_PO_SPECIAL_INSTRUCTIONS2 = '';
  END
  IF (WK_PO_FREIGHT IS NULL) THEN
  BEGIN
     WK_PO_FREIGHT = 0;
  END
  IF (WK_PO_PAYMENT_METHOD IS NULL) THEN
  BEGIN
     WK_PO_PAYMENT_METHOD = '';
  END
  IF (WK_PO_TERMS IS NULL) THEN
  BEGIN
     WK_PO_TERMS = '';
  END
  IF (WK_PO_AMOUNT_PAID IS NULL) THEN
  BEGIN
     WK_PO_AMOUNT_PAID = 0;
  END
  IF (WK_PO_SHIP_VIA IS NULL) THEN
  BEGIN
     WK_PO_SHIP_VIA = '';
  END
  IF (WK_PO_OTHER1 IS NULL) THEN
  BEGIN
     WK_PO_OTHER1 = '';
  END
  IF (WK_PO_OTHER2 IS NULL) THEN
  BEGIN
     WK_PO_OTHER2 = '';
  END
  IF (WK_PO_OTHER3 IS NULL) THEN
  BEGIN
     WK_PO_OTHER3 = '';
  END
  IF (WK_PO_OTHER4 IS NULL) THEN
  BEGIN
     WK_PO_OTHER4 = '';
  END
  IF (WK_PO_OTHER5 IS NULL) THEN
  BEGIN
     WK_PO_OTHER5 = '';
  END
  IF (WK_PO_OTHER6 IS NULL) THEN
  BEGIN
     WK_PO_OTHER6 = '';
  END
  IF (WK_PO_OTHER7 IS NULL) THEN
  BEGIN
     WK_PO_OTHER7 = '';
  END
  IF (WK_PO_OTHER8 IS NULL) THEN
  BEGIN
     WK_PO_OTHER8 = '';
  END
  IF (WK_PO_OTHER9 IS NULL) THEN
  BEGIN
     WK_PO_OTHER9 = '';
  END
  IF (WK_PO_P_FIRST_NAME IS NULL) THEN
  BEGIN
     WK_PO_P_FIRST_NAME = '';
  END
  IF (WK_PO_P_ADDRESS_LINE1 IS NULL) THEN
  BEGIN
     WK_PO_P_ADDRESS_LINE1 = '';
  END
  IF (WK_PO_P_ADDRESS_LINE2 IS NULL) THEN
  BEGIN
     WK_PO_P_ADDRESS_LINE2 = '';
  END
  IF (WK_PO_P_ADDRESS_LINE3 IS NULL) THEN
  BEGIN
     WK_PO_P_ADDRESS_LINE3 = '';
  END
  IF (WK_PO_P_ADDRESS_LINE4 IS NULL) THEN
  BEGIN
     WK_PO_P_ADDRESS_LINE4 = '';
  END
  IF (WK_PO_P_ADDRESS_LINE5 IS NULL) THEN
  BEGIN
     WK_PO_P_ADDRESS_LINE5 = '';
  END
  IF (WK_PO_P_POST_CODE IS NULL) THEN
  BEGIN
     WK_PO_P_POST_CODE = '';
  END
  IF (WK_PO_P_COUNTRY IS NULL) THEN
  BEGIN
     WK_PO_P_COUNTRY = '';
  END
  IF (WK_PO_OVER_SIZED IS NULL) THEN
  BEGIN
     WK_PO_OVER_SIZED = '';
  END
  IF (WK_PO_NET_WEIGHT IS NULL) THEN
  BEGIN
     WK_PO_NET_WEIGHT = 0;
  END
  IF (WK_PO_TAX_AMOUNT IS NULL) THEN
  BEGIN
     WK_PO_TAX_AMOUNT = 0;
  END
  IF (WK_PO_SUB_TOTAL_AMOUNT IS NULL) THEN
  BEGIN
     WK_PO_SUB_TOTAL_AMOUNT = 0;
  END
  IF (WK_PO_FREIGHT_TAX_AMOUNT IS NULL) THEN
  BEGIN
     WK_PO_FREIGHT_TAX_AMOUNT = 0;
  END
  IF (WK_PO_PALLET_BASE IS NULL) THEN
  BEGIN
     WK_PO_PALLET_BASE = '';
  END

  WK_LABEL_TEXT = '"' || WK_ORDER || '","' || 
           WK_PRINTER_DEVICE || '","' ||
           WK_PO_COMPANY_ID || '","' ||
           WK_PO_CUSTOMER_PO_WO || '","' ||
           WK_PO_PICK_DUE_DATE || '","' ||
           WK_PO_PERSON_ID || '","' ||
           WK_PO_CONTACT_NAME || '","' ; 
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
/*
  IF (WK_RESULT <> 0) THEN
  BEGIN
     WK_FILE_PATH2 = WK_FILE_PATH || 'ORDER.2XT';
     WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
  END   
*/
  WK_LABEL_TEXT = WK_PO_SPECIAL_INSTRUCTIONS1;
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
  WK_LABEL_TEXT = '","';
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
  WK_LABEL_TEXT = WK_PO_SPECIAL_INSTRUCTIONS2;
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);
  WK_LABEL_TEXT = '","';
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);

  WK_LABEL_TEXT = WK_PO_FREIGHT || '","' ||
           WK_PO_PAYMENT_METHOD || '","' ||
           WK_PO_TERMS || '","' ||
           WK_PO_AMOUNT_PAID || '","' ||
           WK_PO_SHIP_VIA || '","' ||
           WK_PO_OTHER1 || '","' ||
           WK_PO_OTHER2 || '","' ||
           WK_PO_OTHER3 || '","' ;
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);

  WK_LABEL_TEXT = WK_PO_OTHER4 || '","' ||
           WK_PO_OTHER5 || '","' ||
           WK_PO_OTHER6 || '","' ||
           WK_PO_OTHER7 || '","' ;
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);

  WK_LABEL_TEXT = WK_PO_OTHER8 || '","' ||
           WK_PO_OTHER9 || '","' ||
           WK_PO_P_FIRST_NAME || '","' ;
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);

  WK_LABEL_TEXT =  WK_PO_P_ADDRESS_LINE1 || '","' ||
           WK_PO_P_ADDRESS_LINE2 || '","' ||
           WK_PO_P_ADDRESS_LINE3 || '","' ;
  WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT);

  WK_LABEL_TEXT = WK_PO_P_ADDRESS_LINE4 || '","' ||
           WK_PO_P_ADDRESS_LINE5 || '","' ||
           WK_PO_P_POST_CODE || '","' ||
           WK_PO_P_COUNTRY || '","' ||
           WK_PO_OVER_SIZED || '","' ||
           WK_PO_NET_WEIGHT || '","' ||
           WK_PO_TAX_AMOUNT || '","' ||
           WK_PO_SUB_TOTAL_AMOUNT || '","' ||
           WK_PO_FREIGHT_TAX_AMOUNT || '","' ||
           WK_PO_PALLET_BASE || '"';

  
  WK_RESULT = FILE_WRITELN(:WK_FILE_PATH2, :WK_LABEL_TEXT); 
  /* WK_RESULT = FILE_WRITE(:WK_FILE_PATH2, :WK_LABEL_TEXT); */
  SUSPEND;
  
END ^

SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
