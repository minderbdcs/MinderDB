DROP TRIGGER SYS_USER_ADD_LEVEL ^
DROP TRIGGER SYS_USER_UPD_LEVEL ^
COMMIT^
 
CREATE TRIGGER SYS_USER_ADD_LEVEL FOR SYS_USER
ACTIVE BEFORE INSERT 
AS
DECLARE VARIABLE WK_PERM_LEVEL CHAR(1);
DECLARE VARIABLE WK_PERM_LEVEL_NO INTEGER;
BEGIN
   WK_PERM_LEVEL = '';
   WK_PERM_LEVEL_NO = 0;
   IF (NEW.SYS_ADMIN = 'T') THEN
   BEGIN
      WK_PERM_LEVEL = '1';
   END
   ELSE
   BEGIN
      IF (NEW.SALE_MANAGER = 'T') THEN
      BEGIN
         WK_PERM_LEVEL_NO = WK_PERM_LEVEL_NO + 2;
      END
      IF (NEW.EDITABLE = 'T') THEN
      BEGIN
         WK_PERM_LEVEL_NO = WK_PERM_LEVEL_NO + 4;
      END
      IF (NEW.CREDIT_MANAGER = 'T') THEN
      BEGIN
         WK_PERM_LEVEL_NO = WK_PERM_LEVEL_NO + 8;
      END
      IF (WK_PERM_LEVEL_NO = 0) THEN
      BEGIN
         WK_PERM_LEVEL = '0';
      END
      ELSE
      BEGIN
         WK_PERM_LEVEL = (( WK_PERM_LEVEL_NO / 2) + 1);
      END
   END
   NEW.TASK_PERM_LEVEL = WK_PERM_LEVEL;
END ^
 
CREATE TRIGGER SYS_USER_UPD_LEVEL FOR SYS_USER
ACTIVE BEFORE UPDATE 
AS
DECLARE VARIABLE WK_PERM_LEVEL CHAR(1);
DECLARE VARIABLE WK_PERM_LEVEL_NO INTEGER;
BEGIN
   WK_PERM_LEVEL = '';
   WK_PERM_LEVEL_NO = 0;
   IF (NEW.SYS_ADMIN = 'T') THEN
   BEGIN
      WK_PERM_LEVEL = '1';
   END
   ELSE
   BEGIN
      IF (NEW.SALE_MANAGER = 'T') THEN
      BEGIN
         WK_PERM_LEVEL_NO = WK_PERM_LEVEL_NO + 2;
      END
      IF (NEW.EDITABLE = 'T') THEN
      BEGIN
         WK_PERM_LEVEL_NO = WK_PERM_LEVEL_NO + 4;
      END
      IF (NEW.CREDIT_MANAGER = 'T') THEN
      BEGIN
         WK_PERM_LEVEL_NO = WK_PERM_LEVEL_NO + 8;
      END
      IF (WK_PERM_LEVEL_NO = 0) THEN
      BEGIN
         WK_PERM_LEVEL = '0';
      END
      ELSE
      BEGIN
         WK_PERM_LEVEL = (( WK_PERM_LEVEL_NO / 2) + 1);
      END
   END
   NEW.TASK_PERM_LEVEL = WK_PERM_LEVEL;
END ^
DROP TRIGGER SYS_USER_ADD_LEVEL ^
DROP TRIGGER SYS_USER_UPD_LEVEL ^
COMMIT^
 
